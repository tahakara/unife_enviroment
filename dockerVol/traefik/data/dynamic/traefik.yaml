http:    
  routers:
    fallback-router:
      rule: "HostRegexp(`{host:.+}`)"
      service: noop@internal
      priority: 1
  
    noop-http-https:
      entryPoints:
        - web
        - websecure
      rule: "HostRegexp(`{ip:(^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$|^\\[[0-9a-fA-F:]+\\]$)`)
      service: noop@internal
      priority: 100

    portainer:
      entryPoints:
        - websecure
      rule: "Host(`portainer.tahakara.dev`)"
      service: portainer
      tls:
        certResolver: default
        domains:
          - main: "*.tahakara.dev"
      middlewares:
          - whitelist
          - cloudflare
      priority: 5

    pgadmin:
      entryPoints:
        - websecure
      rule: "Host(`pgadmin.tahakara.dev`)"
      service: pgadmin
      tls:
        certResolver: default
        domains:
          - main: "*.tahakara.dev"
      middlewares:
        - whitelist
      priority: 5

    redisinsight:
      entryPoints:
        - websecure
      rule: "Host(`redisinsight.tahakara.dev`)"
      service: redisinsight
      tls:
        certResolver: default
        domains:
          - main: "*.tahakara.dev"
      middlewares:
        - whitelist
      priority: 5

  middlewares:
    whitelist:
      ipWhiteList:
        sourceRange:
          - "YOUR_IP/32"
    local-white:
      ipWhiteList:
        sourceRange:
          - "10.0.0.0/8"
          - "127.0.0.0/8"
          - "172.16.0.0/12"
          - "192.168.0.0/16"
    cloudflare-white:
      ipWhiteList:
        sourceRange:
          - "173.245.48.0/20"
          - "103.21.244.0/22"
          - "103.22.200.0/22"
          - "103.31.4.0/22"
          - "141.101.64.0/18"
          - "108.162.192.0/18"
          - "190.93.240.0/20"
          - "188.114.96.0/20"
          - "197.234.240.0/22"
          - "198.41.128.0/17"
          - "162.158.0.0/15"
          - "104.16.0.0/13"
          - "104.24.0.0/14"
          - "172.64.0.0/13"
          - "131.0.72.0/22"
          - "2400:cb00::/32"
          - "2606:4700::/32"
          - "2803:f800::/32"
          - "2405:b500::/32"
          - "2405:8100::/32"
          - "2a06:98c0::/29"
          - "2c0f:f248::/32"
    cloudflare:
      ipWhiteList:
        sourceRange:
          - "173.245.48.0/20"
          - "103.21.244.0/22"
          - "103.22.200.0/22"
          - "103.31.4.0/22"
          - "141.101.64.0/18"
          - "108.162.192.0/18"
          - "190.93.240.0/20"
          - "188.114.96.0/20"
          - "197.234.240.0/22"
          - "198.41.128.0/17"
          - "162.158.0.0/15"
          - "104.16.0.0/13"
          - "104.24.0.0/14"
          - "172.64.0.0/13"
          - "131.0.72.0/22"

  services:
    portainer:
      loadBalancer:
        servers:
          - url: "http://portainer:9000"
    pgadmin:
      loadBalancer:
        servers:
          - url: "http://pgadmin:80"
    redisinsight:
      loadBalancer:
        servers:
          - url: "http://redisinsight:8001"
    dummy-service:
      loadBalancer:
        servers:
          - url: noop@internal
    traefik-service:
      loadBalancer:
        servers:
          - url: api@internal

tcp:
  routers:
    postgres:
      entryPoints:
        - postgres
      rule: "HostSNI(`*`)"
      service: postgres
      tls:
        passthrough: true
        options: {}
      middlewares:
          - whitelist
          - cloudflare
      priority: 5

    redis:
      entryPoints:
        - redis
      rule: "HostSNI(`*`)"
      service: redis
      tls:
        passthrough: true
        options: {}
      middlewares:
        - whitelist
      priority: 5

  services:
    postgres:
      loadBalancer:
        servers:
          - address: "postgres:5432"

    redis:
      loadBalancer:
        servers:
          - address: "redis:6379"

  middlewares:
    whitelist:
      ipWhiteList:
        sourceRange:
          - "YOUR_IP/32"
    cloudflare:
      ipWhiteList:
        sourceRange:
          - "173.245.48.0/20"
          - "103.21.244.0/22"
          - "103.22.200.0/22"
          - "103.31.4.0/22"
          - "141.101.64.0/18"
          - "108.162.192.0/18"
          - "190.93.240.0/20"
          - "188.114.96.0/20"
          - "197.234.240.0/22"
          - "198.41.128.0/17"
          - "162.158.0.0/15"
          - "104.16.0.0/13"
          - "104.24.0.0/14"
          - "172.64.0.0/13"
          - "131.0.72.0/22"

certificatesResolvers:
  default:
    acme:
      email: "admin@tahakara.dev"
      storage: "/data/acme.json"
      caServer: "https://acme-v02.api.letsencrypt.org/directory"
      tlsChallenge: {}
    tls:
      certificates:
        - certFile: "/data/certs/wildcard.tahakara.dev/wildcard.tahakara.dev.crt"
          keyFile: "/data/certs/wildcard.tahakara.dev/wildcard.tahakara.dev.key"
